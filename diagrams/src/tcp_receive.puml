@startuml
start
if (Подключен? и size > 0?) then (Да)
    :Установка таймаута;
    :Резервирование буфера;
    while (Получено < size?) is (Да)
        :Чтение части данных (recv);
        if (Ошибка/Таймаут/Разрыв?) then (Да)
            :Обработка ошибки (лог, разрыв);
            :Возврат {};
            stop
        endif
        :Добавление данных в буфер;
    endwhile (Нет)
    :Возврат буфера;
else (Нет)
    :Возврат {};
endif
stop

@enduml